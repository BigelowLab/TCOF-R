<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Coding at the Tandy Center for Ocean Forecasting - Iterations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./iterations.html">Iterations</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Coding at the Tandy Center for Ocean Forecasting</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iterations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Iterations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./files-configurations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuration files</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./files-header-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Files with bad headers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./files-many.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">E pluribus unum</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tables-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Table math</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-for-loop" id="toc-the-for-loop" class="nav-link active" data-scroll-target="#the-for-loop">The for-loop</a>
  <ul class="collapse">
  <li><a href="#some-example-data" id="toc-some-example-data" class="nav-link" data-scroll-target="#some-example-data">Some example data</a></li>
  <li><a href="#how-to-iterate-over-these-things" id="toc-how-to-iterate-over-these-things" class="nav-link" data-scroll-target="#how-to-iterate-over-these-things">How to iterate over <code>these-things</code></a></li>
  </ul></li>
  <li><a href="#iteration-with-lapply-and-sapply" id="toc-iteration-with-lapply-and-sapply" class="nav-link" data-scroll-target="#iteration-with-lapply-and-sapply">Iteration with <code>lapply</code> and <code>sapply</code></a>
  <ul class="collapse">
  <li><a href="#lapply" id="toc-lapply" class="nav-link" data-scroll-target="#lapply"><code>lapply()</code></a></li>
  <li><a href="#sapply" id="toc-sapply" class="nav-link" data-scroll-target="#sapply"><code>sapply()</code></a></li>
  </ul></li>
  <li><a href="#groups-in-a-table" id="toc-groups-in-a-table" class="nav-link" data-scroll-target="#groups-in-a-table">Groups in a table</a>
  <ul class="collapse">
  <li><a href="#an-example-table" id="toc-an-example-table" class="nav-link" data-scroll-target="#an-example-table">An example table</a></li>
  <li><a href="#set-up-the-groups" id="toc-set-up-the-groups" class="nav-link" data-scroll-target="#set-up-the-groups">Set up the groups</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Iterations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Iteration - just what the heck is it really? The word comes from the Latin ‘iterare’ which means to repeat. Computer programs are perfect for doing repetitious things which releases the coder from mundane tasks so we can spend more time checking the internet. But they do have an initial cost - somebody has to code up the iteration. That’s what this tutorial is about: how to code up iterations.</p>
<p>The most famous iteration framework is the <strong>for-loop</strong>, but it has cousins in the <strong>repeat-until</strong> and <strong>while-do</strong> constructs. R-language has additional tools built in for iterating. These are in the <strong>apply</strong> family including <code>lappy</code>, <code>sapply</code>, <code>mapply</code>, <code>tapply</code> and <code>vapply</code>. Third party packages, such as those from <a href="https://www.tidyverse.org/">Tidyverse</a> and <a href="https://rdatatable.gitlab.io/data.table/">data.table</a> also provide tools for iteration.</p>
<section id="the-for-loop" class="level2">
<h2 class="anchored" data-anchor-id="the-for-loop">The for-loop</h2>
<p>The for-loop has a very simple design…</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>for (each of these-things){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  do this</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Technically, we don’t need to add the curly-braced code block, it could be simply…</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>for (each of these-things) do this</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>… but it is always better to err on the side of readability - a code block is simply easier to read than a one-liner.</p>
<section id="some-example-data" class="level3">
<h3 class="anchored" data-anchor-id="some-example-data">Some example data</h3>
<p>Let’s make a simple named vector to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="st">"Alan"</span>, <span class="at">B =</span> <span class="st">"Beryl"</span>, <span class="at">C =</span> <span class="st">"Carlos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-iterate-over-these-things" class="level3">
<h3 class="anchored" data-anchor-id="how-to-iterate-over-these-things">How to iterate over <code>these-things</code></h3>
<p>What goes into the <code>(each of these-things)</code>? You have three choices here: a positional index (1,2,3), a name (A, B, C) or the items themselves (Alan, Beryl, Carlos). Each time the loop runs, it selects one item from your <code>these-things</code> and “delivers” it into the code block.</p>
<section id="iterate-by-position" class="level4">
<h4 class="anchored" data-anchor-id="iterate-by-position">Iterate by position</h4>
<p>Here’s an example using positional indices. Note that we chose to use <code>seq_along(x)</code> to generate our sequence: 1, 2, 3. Using <code>seq_along(x)</code> and <code>seq_len(length(x))</code> are considered good practice because they will <strong>not</strong> throw an error if you happen to have an <code>x</code> with no elements (it happens!) and instead will skip the loop. In our case, we generate our sequence with <code>seq_along(x)</code> which produces 1, 2, 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Hello,"</span>, x[i], <span class="st">"you are number"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello, Alan you are number 1 
Hello, Beryl you are number 2 
Hello, Carlos you are number 3 </code></pre>
</div>
</div>
<p>Using positional indices is often very useful, but keep in mind you can control the order of the sequence if you like. Note here how we reverse the order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(<span class="fu">seq_along</span>(x))){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Hello,"</span>, x[i], <span class="st">"you are number"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hello, Carlos you are number 3 
Hello, Beryl you are number 2 
Hello, Alan you are number 1 </code></pre>
</div>
</div>
</section>
<section id="iterate-by-name" class="level4">
<h4 class="anchored" data-anchor-id="iterate-by-name">Iterate by name</h4>
<p>Of course our object with three elements is a named vector. So we could use the names to iterate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (letter <span class="cf">in</span> <span class="fu">names</span>(x)){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Your name is"</span>, x[[letter]], <span class="st">"and your letter is"</span>, letter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Your name is Alan and your letter is A 
Your name is Beryl and your letter is B 
Your name is Carlos and your letter is C </code></pre>
</div>
</div>
<p>Here, too, you may arrange the order as you please.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (letter <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>)){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Your name is"</span>, x[[letter]], <span class="st">"and your letter is"</span>, letter, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Your name is Beryl and your letter is B 
Your name is Alan and your letter is A 
Your name is Carlos and your letter is C </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is your vector or list unnamed? What do you think will happen if you try to iterate by name? Will it throw an error? Skip the loop? Burst into flames and delete your hard drive?</p>
</div>
</div>
</section>
<section id="iterate-by-item" class="level4">
<h4 class="anchored" data-anchor-id="iterate-by-item">Iterate by item</h4>
<p>Finally, we can iterate by item instead of by position or name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (this_person <span class="cf">in</span> x){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Hi there,"</span>, this_person, <span class="st">"I don't know your letter or position</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hi there, Alan I don't know your letter or position
Hi there, Beryl I don't know your letter or position
Hi there, Carlos I don't know your letter or position</code></pre>
</div>
</div>
<p>Note that iterating by item means we lose the context of order - we don’t know in the code block anything about where in <code>x</code> we come from, and often it doesn’t matter.</p>
</section>
</section>
</section>
<section id="iteration-with-lapply-and-sapply" class="level2">
<h2 class="anchored" data-anchor-id="iteration-with-lapply-and-sapply">Iteration with <code>lapply</code> and <code>sapply</code></h2>
<p><code>lapply</code> and <code>sapply</code> are very similar functions. Each accepts a multi-element object over which it iterates. At each iteration it <strong>applies</strong> a function of your choosing to the current element. This function you choose mustr accept one argument. Once again, we can iterate over positional indices, names (if any) or over the items themselves.</p>
<p>Unlike for-loops, the <code>*apply</code> (where <code>*</code> is “l”, “s”, etc) functions <u>actually return something</u> to you, which opens up all sorts of programming possibilities. Here’s a bit of pseudo-code using a generic <code>*apply</code>. The value of result will hold one <code>modified_thing</code> for every element of <code>these_things</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>result = *apply(these_things,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                function(this_thing){</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  modified_thing = do_something(this_thing)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                  return(modified_thing))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="lapply" class="level3">
<h3 class="anchored" data-anchor-id="lapply"><code>lapply()</code></h3>
<p>Let’s try it by iterating over names in our example data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">lapply</span>(<span class="fu">names</span>(x),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(name){</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                  r <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">"Your name is"</span>, x[[name]], <span class="st">"and your name has"</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">nchar</span>(x[[name]]), <span class="st">"characters"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">return</span>(r)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So what is in <code>result</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p>How many things does it have?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>What are those things?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "Your name is Alan and your name has 4 characters"

[[2]]
[1] "Your name is Beryl and your name has 5 characters"

[[3]]
[1] "Your name is Carlos and your name has 6 characters"</code></pre>
</div>
</div>
<p>The function used doesn’t have to be constructed on the fly (which we call an anonymous or unnamed function), but could be any function listed only by name. This makes it look a bit weird to the untrained eye. But as long as the function accepts one argument, R will deliver that argument for you. Below we used a previously defined function, <code>nchar()</code>, as an example. Note that we switch to iterating over the elements rather than the names of the elements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">lapply</span>(x, nchar)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$A
[1] 4

$B
[1] 5

$C
[1] 6</code></pre>
</div>
</div>
<p>That seems to work, but how did the result get the names <code>A</code>, <code>B</code> and <code>C</code> while it didn’t before? Result naming happens because R tries hard to be useful. When you iterate over a named listing, R will transfer those names to the resulting output (very helpful!)</p>
<p>So, <code>lapply</code> produces a list. What about <code>sapply()</code>?</p>
</section>
<section id="sapply" class="level3">
<h3 class="anchored" data-anchor-id="sapply"><code>sapply()</code></h3>
<p><code>sapply()</code> operates just like <code>lapply()</code> except it tries very hard to simplify the output into a vector or matrix if possible. If R can’t figure out how to simplify the output, then it will likely return a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">sapply</span>(x, nchar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s query this output the same way.</p>
<p>So what is in <code>result</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>How many things does it have?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>What are those things?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A B C 
4 5 6 </code></pre>
</div>
</div>
<p>Oh, interesting, unlike <code>lapply</code> which produced a named list, <code>sapply</code> produced a named vector - thus “simplified”!</p>
<p>You can suppress the the simplification to make <code>sapply</code> just like <code>lapply</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">sapply</span>(x, nchar, <span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$A
[1] 4

$B
[1] 5

$C
[1] 6</code></pre>
</div>
</div>
<p>So, <code>sapply</code> can produce a simple vector, but it can also produce a list. What about producing a matrix? And do you even want that? (Answer: sometimes!) A matrix is produced when the function produces a vector of more than one element. Below we define an anonymous function that returns a two element vector (name and value). Note that we are now iterating over the names of <code>x</code> rather than the elements of x.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">names</span>(x), </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(name){</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">return</span>(<span class="fu">c</span>(name, x[[name]]))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s query the output…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chr [1:2, 1:3] "A" "Alan" "B" "Beryl" "C" "Carlos"
 - attr(*, "dimnames")=List of 2
  ..$ : NULL
  ..$ : chr [1:3] "A" "B" "C"</code></pre>
</div>
</div>
<p>Well, there we go, a 2-row, 3-column matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A      B       C       
[1,] "A"    "B"     "C"     
[2,] "Alan" "Beryl" "Carlos"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are like most mortals you may be disappointed that the matrix looks sideways. It feels like it should be a column of names (A, B and C) followed by a column of items (Alan, Beryl and Carlos) rather than a row of each. You can switch things to make it look righter using the matrix transpose function <code>t()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2]    
A "A"  "Alan"  
B "B"  "Beryl" 
C "C"  "Carlos"</code></pre>
</div>
</div>
<p>That feels better somehow.</p>
</div>
</div>
</section>
</section>
<section id="groups-in-a-table" class="level2">
<h2 class="anchored" data-anchor-id="groups-in-a-table">Groups in a table</h2>
<p>It is very common to have a flat table (data.frame) where rows are grouped, not in contiguous rows perhaps, but by a common value in a particular column. In fact, you may have the need to have multiple groupings - nested groups, where we first group by “this” and then within each of those groups we group by “that”. There’s no limited on how many nested groups you might envision in a table. The <a href="https://dplyr.tidyverse.org/">dplyr package</a> and friends provide easy utilities for iterating over these groups. In this case, the process is loosely described as mapping a portion of a table (a group) to a function. There are a number of these utilities, but we’ll focus on <code>group_map()</code>.</p>
<section id="an-example-table" class="level3">
<h3 class="anchored" data-anchor-id="an-example-table">An example table</h3>
<p>We have created a function that produces a table in the <a href="./files-many.html">E pluribus unum</a> tutorial. The table is synthetic data about a study on fictitious guppies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"setup.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/jevanilla/Documents/Bigelow/CODE/TCOF-R</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">read_guppy</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 11
   site_id       x        y time                researcher shade gps_codes    id
   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         1
 2 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         2
 3 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         3
 4 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         4
 5 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         5
 6 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         6
 7 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         7
 8 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         8
 9 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         9
10 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q        10
# ℹ 95 more rows
# ℹ 3 more variables: treatment &lt;chr&gt;, count &lt;dbl&gt;, dose &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="set-up-the-groups" class="level3">
<h3 class="anchored" data-anchor-id="set-up-the-groups">Set up the groups</h3>
<p>Let’s do something very simple; “for each treatment-shade group, let’s craft a table of the minimum and maximum doses, as well as the mean count.” Note that we use the same iterative language we used above, “for each thing do this”, where in this case “thing” means treatment-shade group.</p>
<p>First, let’s see how many treatment groups we should expect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ngroups <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">count</span>(x, treatment, shade) <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 3
   treatment shade     n
   &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
 1 A            20     3
 2 A            30     3
 3 A            40     3
 4 A            50     9
 5 B            20     1
 6 B            30     7
 7 B            40     5
 8 B            50    12
 9 C            20     4
10 C            30     3
11 C            40     6
12 C            50    11
13 D            30     3
14 D            40     6
15 D            50    10
16 E            20     2
17 E            30     2
18 E            40     5
19 E            50    10</code></pre>
</div>
</div>
<p>OK, there are 19 treatment-shade groups so we should expect our summary table to have 19 rows (one for each treatment-shade group.) This is good info to have to help check our work.</p>
<p>Next we assign to the table the identity of the grouping variable - that is, which column contains the treatment-shade identifiers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(x, treatment, shade) <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 11
# Groups:   treatment, shade [19]
   site_id       x        y time                researcher shade gps_codes    id
   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
 1 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         1
 2 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         2
 3 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         3
 4 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         4
 5 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         5
 6 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         6
 7 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         7
 8 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         8
 9 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q         9
10 site_01 452032. 4857765. 2020-05-16 07:26:25 JPO           30 c-q-q        10
# ℹ 95 more rows
# ℹ 3 more variables: treatment &lt;chr&gt;, count &lt;dbl&gt;, dose &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The only change here is that we see a notation, in the header, about the groupings. We can access information about the groupings, including the names of the grouping variables…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">groups</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
treatment

[[2]]
shade</code></pre>
</div>
</div>
<p>… a table of the keys (the values of each group)…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_keys</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 2
   treatment shade
   &lt;chr&gt;     &lt;dbl&gt;
 1 A            20
 2 A            30
 3 A            40
 4 A            50
 5 B            20
 6 B            30
 7 B            40
 8 B            50
 9 C            20
10 C            30
11 C            40
12 C            50
13 D            30
14 D            40
15 D            50
16 E            20
17 E            30
18 E            40
19 E            50</code></pre>
</div>
</div>
<p>… or even a listing of the row numbers for each group…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">group_data</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 3
   treatment shade       .rows
   &lt;chr&gt;     &lt;dbl&gt; &lt;list&lt;int&gt;&gt;
 1 A            20         [3]
 2 A            30         [3]
 3 A            40         [3]
 4 A            50         [9]
 5 B            20         [1]
 6 B            30         [7]
 7 B            40         [5]
 8 B            50        [12]
 9 C            20         [4]
10 C            30         [3]
11 C            40         [6]
12 C            50        [11]
13 D            30         [3]
14 D            40         [6]
15 D            50        [10]
16 E            20         [2]
17 E            30         [2]
18 E            40         [5]
19 E            50        [10]</code></pre>
</div>
</div>
<p>This is perfect! Just what we might need to iterate over each grouping. The first group (treatment = A, shade = 20) has three records which we find at rows 73, 74 and 75. Now we could iterate over each row of the <code>group_data(x)</code> output, fishing out the rows for each and then making our computations. But…</p>
<p>The <a href="https://dplyr.tidyverse.org/">dplyr</a> provides a set of tools that perform much of what we have seen with <code>lapply()</code> and <code>sapply()</code> - running an iterator, applying a function and returning something. These functions are <code>group_map()</code>, <code>group_walk()</code> and <code>group_modify()</code>. We’ll focus only upon <code>group_map()</code>, but do check out the others. Also, keep in mind there are <a href="https://rseek.org/?q=group_map">hundreds of examples and tutorials</a> on the web that you can follow.</p>
<p>Just like with <code>lapply()</code> and <code>sapply()</code>, we need a function to operate upon each group. Unlike <code>lapply()</code> and <code>sapply()</code>, the function we use (or create) <strong>must</strong> accept two positional arguments. The first, which we call <code>tbl</code> (short for table), contains the data for the group while the second, which we call <code>key</code> contains a tiny table of the key for that group. In our example, the key for each iteration would be one row of the output of <code>group_keys(x)</code> that you see above.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can call those two arguments whatever you like. We adopt <code>tbl</code> and <code>key</code> only as a convention that we like. You can devise your own convention, or use different argument names every time (as long as your head doesn’t explode.)</p>
</div>
</div>
<p>Here’s a reminder of our goal: <em>“for each treatment-shade group, let’s craft a table of the minimum and maximum doses, as well as the mean count.”</em> So, our function needs to compute the min and max doses, as well as the mean count. Now <code>key</code> will be a little table with treatment and shade, we could simply mutate that, adding columns for <code>min_dose</code>, <code>max_dose</code> and <code>mean_count</code>. Of course, the actual data for <code>dose</code> and <code>count</code> will be in the first argument, <code>tbl</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>summarize_one_group <span class="ot">=</span> <span class="cf">function</span>(tbl, key){</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  key <span class="ot">=</span> key <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">min_dose =</span> <span class="fu">min</span>(tbl<span class="sc">$</span>dose),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max_dose =</span> <span class="fu">max</span>(tbl<span class="sc">$</span>dose),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mean_count =</span> <span class="fu">mean</span>(tbl<span class="sc">$</span>count))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(key)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OK, so how do we use the function? It’s easy, much as you did for, say <code>lapply()</code>, you provide the thing to iterate over and the function to apply at each iteration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">group_map</span>(x, summarize_one_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But what is in the result? (Hopefully 19!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(result) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19</code></pre>
</div>
</div>
<p>Let’s look at just the first three items returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>result[<span class="fu">seq_len</span>(<span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 1 × 5
  treatment shade min_dose max_dose mean_count
  &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 A            20        0      0.8       56.7

[[2]]
# A tibble: 1 × 5
  treatment shade min_dose max_dose mean_count
  &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 A            30      0.4      0.9       49.7

[[3]]
# A tibble: 1 × 5
  treatment shade min_dose max_dose mean_count
  &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 A            40        0      0.3         52</code></pre>
</div>
</div>
<p>OK - so we got back 19 tables, well those are easy to bind into one table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(result) <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 5
   treatment shade min_dose max_dose mean_count
   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 A            20      0        0.8       56.7
 2 A            30      0.4      0.9       49.7
 3 A            40      0        0.3       52  
 4 A            50      0        1         49.9
 5 B            20      1        1         31  
 6 B            30      0        1         57.1
 7 B            40      0        0.8       48.6
 8 B            50      0        1         45.9
 9 C            20      0        0.9       46  
10 C            30      0.7      1         40.3
11 C            40      0.2      1         40.8
12 C            50      0.2      1         47.7
13 D            30      0.5      0.7       42.3
14 D            40      0.1      0.9       57.7
15 D            50      0.1      1         49.2
16 E            20      0.1      0.7       51.5
17 E            30      0.8      0.8       54.5
18 E            40      0.7      0.9       63.4
19 E            50      0        1         41.6</code></pre>
</div>
</div>
<p>Well, that was easy. It’s not unusual to compress these steps into one convenient workflow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(x, treatment, shade) <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_map</span>(summarize_one_group) <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 5
   treatment shade min_dose max_dose mean_count
   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 A            20      0        0.8       56.7
 2 A            30      0.4      0.9       49.7
 3 A            40      0        0.3       52  
 4 A            50      0        1         49.9
 5 B            20      1        1         31  
 6 B            30      0        1         57.1
 7 B            40      0        0.8       48.6
 8 B            50      0        1         45.9
 9 C            20      0        0.9       46  
10 C            30      0.7      1         40.3
11 C            40      0.2      1         40.8
12 C            50      0.2      1         47.7
13 D            30      0.5      0.7       42.3
14 D            40      0.1      0.9       57.7
15 D            50      0.1      1         49.2
16 E            20      0.1      0.7       51.5
17 E            30      0.8      0.8       54.5
18 E            40      0.7      0.9       63.4
19 E            50      0        1         41.6</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>